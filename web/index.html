<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Вычислительная задача №129</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: #f9f9f9;
    }

    label {
      display: block;
      margin-top: 15px;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    canvas {
      margin-top: 30px;
    }

    .error {
      color: red;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Вычислительная задача №129</h1>

  <form id="calcForm">
    <label>Параметр a: <input type="number" id="a" step="any" required></label>
    <label>Начало отрезка c: <input type="number" id="c" step="any" required></label>
    <label>Конец отрезка d: <input type="number" id="d" step="any" required></label>
    <label>Точность e: <input type="number" id="e" step="any" min="0.000001" required></label>
    <button type="submit">Вычислить</button>
  </form>

  <div class="error" id="errorMsg"></div>

  <div class="result" id="results" style="display:none">
    <p><strong>y(a):</strong> <span id="ya"></span></p>
    <p><strong>z<sub>max</sub>:</strong> <span id="zmax"></span></p>
    <p><strong>F(z<sub>max</sub>):</strong> <span id="fzmax"></span></p>
    <p><strong>Площадь (трапеции):</strong> <span id="areaTrap"></span></p>
    <p><strong>Площадь (Симпсон):</strong> <span id="areaSimp"></span></p>
    <p><strong>Корень уравнения F(z)=0:</strong> <span id="root"></span></p>
  </div>

  <canvas id="chart" width="600" height="300" style="display:none;"></canvas>

  <script>
    const form = document.getElementById("calcForm");
    const errorMsg = document.getElementById("errorMsg");

    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      errorMsg.textContent = "";

      const a = document.getElementById("a").value;
      const c = document.getElementById("c").value;
      const d = document.getElementById("d").value;
      const eVal = document.getElementById("e").value;

      if (!a || !c || !d || !eVal) {
        errorMsg.textContent = "Пожалуйста, заполните все поля.";
        return;
      }

      const payload = {
        a: parseFloat(a),
        c: parseFloat(c),
        d: parseFloat(d),
        e: parseFloat(eVal)
      };

      console.log("Отправка:", payload);

      try {
        const res = await fetch("http://localhost:8080/solve", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const errText = await res.text();
          throw new Error("Ошибка от сервера: " + errText);
        }

        const data = await res.json();
        console.log("Ответ:", data);

        // Отобразим данные
        document.getElementById("results").style.display = "block";
        document.getElementById("ya").textContent = data.y_a.toFixed(6);
        document.getElementById("zmax").textContent = data.z_max.toFixed(6);
        document.getElementById("fzmax").textContent = data.f_z_max.toFixed(6);
        document.getElementById("areaTrap").textContent = data.area_trapezoid.toFixed(6);
        document.getElementById("areaSimp").textContent = data.area_simpson.toFixed(6);
        document.getElementById("root").textContent = data.zero_point.toFixed(6);

        drawChart(data);

      } catch (err) {
        console.error(err);
        errorMsg.textContent = "Ошибка: " + err.message;
      }
    });

    function drawChart(data) {
      const ctx = document.getElementById("chart").getContext("2d");
      document.getElementById("chart").style.display = "block";

      const xVals = [];
      const yVals = [];

      const zStart = data.zero_point - 2;
      const zEnd = data.zero_point + 2;
      const step = 0.1;

      for (let z = zStart; z <= zEnd; z += step) {
        xVals.push(z.toFixed(2));
        const fz = (data.y_a * Math.sin(z)).toFixed(6); // <-- примерная функция, адаптируй под свою!
        yVals.push(fz);
      }

      new Chart(ctx, {
        type: "line",
        data: {
          labels: xVals,
          datasets: [{
            label: "F(z)",
            data: yVals,
            fill: false,
            borderColor: "#3498db",
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: true
            }
          }
        }
      });
    }
  </script>
</body>
</html>
